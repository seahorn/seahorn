# Building SeaHorn with Docker and running tests

## seahorn-build.Dockerfile (downloading build dependencies):
```shell
docker build --build-arg UBUNTU=xenial --build-arg BUILD_TYPE=Release -t seahorn/seahorn-build:xenial -f docker/seahorn-build.Dockerfile .
```
The above generates a container with all dependencies required to build SeaHorn,
other than SeaHorn itself.

Build arguments (required):
- UBUNTU: trusty, xenial, bionic
- BUILD_TYPE: Release, Debug

Depends on: `buildpack-deps`
Dockerhub: `docker pull seahorn/seahorn-build`

## seahorn-full-size-rel.Dockerfile (building SeaHorn with Docker):
```shell
docker build --build-arg UBUNTU=xenial --build-arg BUILD_TYPE=Release -t seahorn_xenial_rel -f docker/seahorn-full-size-rel.Dockerfile .
docker run -v `pwd`:/host -it seahorn_xenial_rel /bin/sh -c "cp build/*.tar.gz /host/"
```
This will automatically download all dependencies from a base image 
(generated by `seahorn-build.Dockerfile`) and build SeaHorn under
`/seahorn/build`.

SeaHorn's install directory is added to PATH, and a tarball with it is ready
 under the current working directory (on the host).

Build arguments (required):
- UBUNTU: trusty, xenial
- BUILD_TYPE: Release, Debug
- *TRAVIS: optional argument, for use on Travis only*

Depends on: `seahorn/seahorn-build`

## seahorn.Dockerfile (building a minimal docker image containing SeaHorn):
Build and run SeaHorn as detailed above, then run the following in the directory
containing the tarball:
```shell
docker build -t seahorn/seahorn -f docker/seahorn.Dockerfile .
docker run -v `pwd`:/host -it seahorn/seahorn
```

Build arguments (required):
- *BASE_IMAGE: optional argument, set to either `ubuntu` (default) or
  `seahorn/seahorn` (Travis only)*

Depends on:
- `ubuntu` unless otherwise specified by $BASE_IMAGE
- there must be a tarball containing seahorn in the host directory
Dockerhub: `docker pull seahorn/seahorn`

The tests will be located in `/opt/seahorn/share/seahorn/test` and can be run
with `lit simple solve abc dsa`.

## To push to dockerhub:
1. `export DOCKER_ID_USER="username"`
2. `docker login`
3. Find the newly built image by running `docker image ls`.
4. Tag this image with a tag matching the intended tag on dockerhub, e.g.,
   `seahorn/seahorn-llvm5:latest`.
5. `docker push`.
